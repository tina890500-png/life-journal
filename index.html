<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f5f6f7;
  padding: 16px;
  margin: 0;
}
h1, h2 {
  text-align: center;
}
.card {
  background: white;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
label {
  font-weight: bold;
  display: block;
  margin-top: 12px;
}
textarea, input[type="date"], input[type="text"] {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 16px;
  margin-top: 6px;
}
button {
  width: 100%;
  padding: 12px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  background: #4CAF50;
  color: white;
  margin-top: 12px;
}
.item {
  border-bottom: 1px dashed #ddd;
  padding: 8px 0;
}
.small {
  font-size: 13px;
  color: #666;
}
</style>
</head>

<body>

<h1>ğŸ“” é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</h1>
<h2 id="countdown"></h2>

<div class="card">
  <label>æ—¥æœŸ</label>
  <input type="date" id="date">

  <label>ä»Šæ—¥ä¸€å¥è©±</label>
  <textarea id="focus" rows="2"></textarea>

  <label>ä»Šå¤©å®Œæˆäº†ä»€éº¼</label>
  <textarea id="done" rows="3"></textarea>

  <label>æ˜å¤©åªåšä¸€ä»¶äº‹</label>
  <textarea id="tomorrow" rows="2"></textarea>

  <button onclick="saveDay()">ğŸ’¾ å„²å­˜</button>
</div>

<div class="card">
  <h2>ğŸ¯ å¹´åº¦è¦åŠƒ</h2>
  <div id="yearList"></div>
  <button onclick="addYear()">ï¼‹ æ–°å¢å¹´åº¦ç›®æ¨™</button>
</div>

<div class="card">
  <h2>ğŸ—“ æ¯æœˆè¦åŠƒ</h2>
  <div id="monthList"></div>
  <button onclick="addMonth()">ï¼‹ æ–°å¢æœˆè¨ˆç•«</button>
</div>

<div class="card">
  <h2>ğŸ“¤ åŒ¯å‡ºå…¨éƒ¨æ—¥èªŒ</h2>
  <button onclick="exportTXT()">ä¸‹è¼‰ / é¡¯ç¤º TXT</button>
  <pre id="txtOutput" class="small"></pre>
</div>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ========= Firebase è¨­å®šï¼ˆå·²å¹«ä½ å¡«å¥½ï¼‰ ========= */
const firebaseConfig = {
  apiKey: "AIzaSyBsmMJMO4JO3tidNwMGGWXCEwKA6Np-Kc4",
  authDomain: "tina-life-journal.firebaseapp.com",
  projectId: "tina-life-journal",
  storageBucket: "tina-life-journal.firebasestorage.app",
  messagingSenderId: "667372563944",
  appId: "1:667372563944:web:7bef6d41638ca1ac15885d",
  measurementId: "G-H56RTHK7RL"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ========= å€’æ•¸å¤©æ•¸ ========= */
const retireDate = new Date("2026-10-10");
const today = new Date();
document.getElementById("countdown").innerText =
  "è·é›¢é€€ä¼‘é‚„æœ‰ " + Math.ceil((retireDate - today) / (1000*60*60*24)) + " å¤©";

/* ========= æ—¥æœŸ ========= */
const dateEl = document.getElementById("date");
dateEl.value = today.toISOString().split("T")[0];

/* ========= æ¯æ—¥ç´€éŒ„ ========= */
async function saveDay() {
  await db.collection("days").doc(dateEl.value).set({
    focus: focus.value,
    done: done.value,
    tomorrow: tomorrow.value
  });
  alert("å·²åŒæ­¥å„²å­˜");
}

async function loadDay() {
  const d = await db.collection("days").doc(dateEl.value).get();
  if (d.exists) {
    const r = d.data();
    focus.value = r.focus || "";
    done.value = r.done || "";
    tomorrow.value = r.tomorrow || "";
  } else {
    focus.value = "";
    done.value = "";
    tomorrow.value = "";
  }
}
dateEl.onchange = loadDay;
loadDay();

/* ========= å¹´åº¦è¦åŠƒ ========= */
function addYear() {
  db.collection("year").add({ title: "", note: "" });
}
db.collection("year").onSnapshot(snap => {
  yearList.innerHTML = "";
  snap.forEach(doc => {
    const r = doc.data();
    yearList.innerHTML += `
      <div class="item">
        <input value="${r.title}" placeholder="å¹´åº¦ç›®æ¨™"
          onchange="db.collection('year').doc('${doc.id}').update({title:this.value})">
        <textarea rows="2" placeholder="åŸ·è¡Œèªªæ˜"
          onchange="db.collection('year').doc('${doc.id}').update({note:this.value})">${r.note}</textarea>
        <button onclick="db.collection('year').doc('${doc.id}').delete()">åˆªé™¤</button>
      </div>`;
  });
});

/* ========= æ¯æœˆè¦åŠƒ ========= */
function addMonth() {
  db.collection("month").add({ title: "", note: "" });
}
db.collection("month").onSnapshot(snap => {
  monthList.innerHTML = "";
  snap.forEach(doc => {
    const r = doc.data();
    monthList.innerHTML += `
      <div class="item">
        <input value="${r.title}" placeholder="æœˆè¨ˆç•«"
          onchange="db.collection('month').doc('${doc.id}').update({title:this.value})">
        <textarea rows="2" placeholder="åŸ·è¡Œèªªæ˜"
          onchange="db.collection('month').doc('${doc.id}').update({note:this.value})">${r.note}</textarea>
        <button onclick="db.collection('month').doc('${doc.id}').delete()">åˆªé™¤</button>
      </div>`;
  });
});

/* ========= åŒ¯å‡º TXTï¼ˆPad å‹å–„ï¼‰ ========= */
async function exportTXT() {
  let out = "";
  const snap = await db.collection("days").get();
  snap.forEach(doc => {
    const r = doc.data();
    out += `ã€${doc.id}ã€‘\n${r.focus || ""}\nå®Œæˆï¼š${r.done || ""}\n\n`;
  });
  txtOutput.textContent = out;

  try {
    const blob = new Blob([out], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "é€€ä¼‘æ—¥èªŒ.txt";
    a.click();
  } catch (e) {}
}
</script>

</body>
</html>
