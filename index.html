<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#f5f6f7;padding:16px;margin:0}
h1,h2{text-align:center}
.card{background:white;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
label{font-weight:bold;display:block;margin-top:12px}
textarea,input[type="date"],input[type="text"]{width:100%;border-radius:8px;border:1px solid #ccc;padding:8px;font-size:16px;margin-top:6px}
button{width:100%;padding:12px;font-size:16px;border-radius:10px;border:none;background:#4CAF50;color:white;margin-top:12px}
.item,.log{border-bottom:1px dashed #ddd;padding:8px 0;font-size:14px}
.small{font-size:13px;color:#666}
</style>
</head>

<body>

<h1>ğŸ“” é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</h1>
<h2 id="countdown"></h2>

<div class="card">
  <label>æ—¥æœŸ</label>
  <input type="date" id="date">
  <label>ä»Šæ—¥ä¸€å¥è©±</label>
  <textarea id="focus"></textarea>
  <label>ä»Šå¤©å®Œæˆäº†ä»€éº¼</label>
  <textarea id="done"></textarea>
  <label>æ˜å¤©åªåšä¸€ä»¶äº‹</label>
  <textarea id="tomorrow"></textarea>
  <button onclick="saveDay()">ğŸ’¾ å„²å­˜ä»Šæ—¥</button>
</div>

<div class="card">
  <h2>ğŸ¯ å¹´åº¦ç›®æ¨™</h2>
  <div id="yearList"></div>
  <button onclick="addYear()">ï¼‹ æ–°å¢å¹´åº¦ç›®æ¨™</button>
</div>

<div class="card">
  <h2>ğŸ—“ æ¯æœˆè¦åŠƒ</h2>
  <div id="monthList"></div>
  <button onclick="addMonth()">ï¼‹ æ–°å¢æœˆè¨ˆç•«</button>
</div>

<div class="card">
  <h2>ğŸ“š å…¨éƒ¨å…§å®¹ç¸½è¦½</h2>
  <div id="overview"></div>
</div>

<div class="card">
  <h2>ğŸ“¤ åŒ¯å‡ºå…¨éƒ¨å…§å®¹</h2>
  <button onclick="exportTXT()">ä¸‹è¼‰ / é¡¯ç¤º TXT</button>
  <pre id="txtOutput" class="small"></pre>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* Firebase */
firebase.initializeApp({
  apiKey:"AIzaSyBsmMJMO4JO3tidNwMGGWXCEwKA6Np-Kc4",
  authDomain:"tina-life-journal.firebaseapp.com",
  projectId:"tina-life-journal"
});
const db=firebase.firestore();

/* DOM */
const dateEl=document.getElementById("date");
const focusEl=document.getElementById("focus");
const doneEl=document.getElementById("done");
const tomorrowEl=document.getElementById("tomorrow");
const yearList=document.getElementById("yearList");
const monthList=document.getElementById("monthList");
const overview=document.getElementById("overview");
const txtOutput=document.getElementById("txtOutput");

/* å€’æ•¸ */
const retireDate=new Date("2026-10-10");
const today=new Date();
document.getElementById("countdown").innerText=
"è·é›¢é€€ä¼‘é‚„æœ‰ "+Math.ceil((retireDate-today)/(1000*60*60*24))+" å¤©";
dateEl.value=today.toISOString().split("T")[0];

/* æ¯æ—¥ */
async function saveDay(){
  await db.collection("days").doc(dateEl.value).set({
    date:dateEl.value,
    focus:focusEl.value,
    done:doneEl.value,
    tomorrow:tomorrowEl.value
  });
  alert("ä»Šæ—¥å·²å„²å­˜");
}

/* å¹´åº¦ */
function addYear(){ db.collection("year").add({title:"",note:"",ts:Date.now()}); }
db.collection("year").onSnapshot(s=>{
  yearList.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    yearList.innerHTML+=`
    <div class="item">
      <input value="${r.title}" placeholder="å¹´åº¦ç›®æ¨™"
        onchange="db.collection('year').doc('${d.id}').update({title:this.value})">
      <textarea onchange="db.collection('year').doc('${d.id}').update({note:this.value})"
      placeholder="èªªæ˜">${r.note||""}</textarea>
    </div>`;
  });
});

/* æ¯æœˆ */
function addMonth(){ db.collection("month").add({title:"",note:"",ts:Date.now()}); }
db.collection("month").onSnapshot(s=>{
  monthList.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    monthList.innerHTML+=`
    <div class="item">
      <input value="${r.title}" placeholder="æœˆè¨ˆç•«"
        onchange="db.collection('month').doc('${d.id}').update({title:this.value})">
      <textarea onchange="db.collection('month').doc('${d.id}').update({note:this.value})"
      placeholder="èªªæ˜">${r.note||""}</textarea>
    </div>`;
  });
});

/* ç¸½è¦½ */
db.collection("days").orderBy("date","desc").onSnapshot(s=>{
  overview.innerHTML="<h3>ğŸ“” æ—¥èªŒ</h3>";
  s.forEach(d=>{
    const r=d.data();
    overview.innerHTML+=`
    <div class="log">
      <b>${r.date}</b><br>
      ${r.focus||""}<br>
      å®Œæˆï¼š${r.done||""}<br>
      æ˜æ—¥ï¼š${r.tomorrow||""}
    </div>`;
  });
});

/* åŒ¯å‡º */
async function exportTXT(){
  let out="";
  (await db.collection("year").get()).forEach(d=>{
    const r=d.data(); out+=`ã€å¹´åº¦ã€‘${r.title}\n${r.note}\n\n`;
  });
  (await db.collection("month").get()).forEach(d=>{
    const r=d.data(); out+=`ã€æ¯æœˆã€‘${r.title}\n${r.note}\n\n`;
  });
  (await db.collection("days").orderBy("date").get()).forEach(d=>{
    const r=d.data();
    out+=`ã€${r.date}ã€‘\n${r.focus}\nå®Œæˆï¼š${r.done}\næ˜æ—¥ï¼š${r.tomorrow}\n\n`;
  });
  txtOutput.textContent=out;
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([out],{type:"text/plain"}));
  a.download="é€€ä¼‘ç”Ÿæ´»å…¨ç´€éŒ„.txt";
  a.click();
}
</script>

</body>
</html>
