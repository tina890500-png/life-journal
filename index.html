<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f5f6f7;
  padding: 16px;
  margin: 0;
}
h1, h2 {
  text-align: center;
}
.card {
  background: white;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,.08);
}
label {
  font-weight: bold;
  display: block;
  margin-top: 12px;
}
textarea, input[type="date"], input[type="text"] {
  width: 100%;
  border-radius: 8px;
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 16px;
  margin-top: 6px;
}
button {
  width: 100%;
  padding: 12px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
  background: #4CAF50;
  color: white;
  margin-top: 12px;
}
.item {
  border-bottom: 1px dashed #ddd;
  padding: 8px 0;
}
.log-item {
  border-bottom: 1px solid #eee;
  padding: 10px 0;
  font-size: 14px;
}
.small {
  font-size: 13px;
  color: #666;
}
</style>
</head>

<body>

<h1>ğŸ“” é€€ä¼‘å‰ 300 å¤©æ—¥èªŒ</h1>
<h2 id="countdown"></h2>

<!-- æ¯æ—¥è¼¸å…¥ -->
<div class="card">
  <label>æ—¥æœŸ</label>
  <input type="date" id="date">

  <label>ä»Šæ—¥ä¸€å¥è©±</label>
  <textarea id="focus" rows="2"></textarea>

  <label>ä»Šå¤©å®Œæˆäº†ä»€éº¼</label>
  <textarea id="done" rows="3"></textarea>

  <label>æ˜å¤©åªåšä¸€ä»¶äº‹</label>
  <textarea id="tomorrow" rows="2"></textarea>

  <button onclick="saveDay()">ğŸ’¾ å„²å­˜ä»Šæ—¥</button>
</div>

<!-- å¹´åº¦è¦åŠƒ -->
<div class="card">
  <h2>ğŸ¯ å¹´åº¦è¦åŠƒ</h2>
  <div id="yearList"></div>
  <button onclick="addYear()">ï¼‹ æ–°å¢å¹´åº¦ç›®æ¨™</button>
</div>

<!-- æ¯æœˆè¦åŠƒ -->
<div class="card">
  <h2>ğŸ—“ æ¯æœˆè¦åŠƒ</h2>
  <div id="monthList"></div>
  <button onclick="addMonth()">ï¼‹ æ–°å¢æœˆè¨ˆç•«</button>
</div>

<!-- å…¨éƒ¨æ—¥èªŒ -->
<div class="card">
  <h2>ğŸ“š å…¨éƒ¨æ—¥èªŒç´€éŒ„</h2>
  <div id="allLogs"></div>
</div>

<!-- åŒ¯å‡º -->
<div class="card">
  <h2>ğŸ“¤ åŒ¯å‡ºå…¨éƒ¨æ—¥èªŒ</h2>
  <button onclick="exportTXT()">ä¸‹è¼‰ / é¡¯ç¤º TXT</button>
  <pre id="txtOutput" class="small"></pre>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* Firebase è¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyBsmMJMO4JO3tidNwMGGWXCEwKA6Np-Kc4",
  authDomain: "tina-life-journal.firebaseapp.com",
  projectId: "tina-life-journal",
  storageBucket: "tina-life-journal.firebasestorage.app",
  messagingSenderId: "667372563944",
  appId: "1:667372563944:web:7bef6d41638ca1ac15885d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* å€’æ•¸ */
const retireDate = new Date("2026-10-10");
const today = new Date();
countdown.innerText =
  "è·é›¢é€€ä¼‘é‚„æœ‰ " + Math.ceil((retireDate - today)/(1000*60*60*24)) + " å¤©";

/* æ—¥æœŸ */
date.value = today.toISOString().split("T")[0];

/* å„²å­˜æ¯æ—¥ */
async function saveDay(){
  await db.collection("days").doc(date.value).set({
    date: date.value,
    focus: focus.value,
    done: done.value,
    tomorrow: tomorrow.value
  });
  alert("å·²å„²å­˜");
}

/* è¼‰å…¥å–®æ—¥ */
async function loadDay(){
  const d = await db.collection("days").doc(date.value).get();
  if(d.exists){
    const r = d.data();
    focus.value = r.focus || "";
    done.value = r.done || "";
    tomorrow.value = r.tomorrow || "";
  } else {
    focus.value = done.value = tomorrow.value = "";
  }
}
date.onchange = loadDay;
loadDay();

/* å¹´åº¦è¦åŠƒ */
function addYear(){
  db.collection("year").add({title:"",note:""});
}
db.collection("year").onSnapshot(s=>{
  yearList.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    yearList.innerHTML+=`
      <div class="item">
        <input value="${r.title}"
          onchange="db.collection('year').doc('${d.id}').update({title:this.value})"
          placeholder="å¹´åº¦ç›®æ¨™">
        <textarea rows="2"
          onchange="db.collection('year').doc('${d.id}').update({note:this.value})"
          placeholder="åŸ·è¡Œèªªæ˜">${r.note}</textarea>
        <button onclick="db.collection('year').doc('${d.id}').delete()">åˆªé™¤</button>
      </div>`;
  });
});

/* æ¯æœˆè¦åŠƒ */
function addMonth(){
  db.collection("month").add({title:"",note:""});
}
db.collection("month").onSnapshot(s=>{
  monthList.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    monthList.innerHTML+=`
      <div class="item">
        <input value="${r.title}"
          onchange="db.collection('month').doc('${d.id}').update({title:this.value})"
          placeholder="æœˆè¨ˆç•«">
        <textarea rows="2"
          onchange="db.collection('month').doc('${d.id}').update({note:this.value})"
          placeholder="åŸ·è¡Œèªªæ˜">${r.note}</textarea>
        <button onclick="db.collection('month').doc('${d.id}').delete()">åˆªé™¤</button>
      </div>`;
  });
});

/* é¡¯ç¤ºå…¨éƒ¨æ—¥èªŒ */
db.collection("days").orderBy("date","desc").onSnapshot(s=>{
  allLogs.innerHTML="";
  s.forEach(d=>{
    const r=d.data();
    allLogs.innerHTML+=`
      <div class="log-item">
        <b>${r.date}</b><br>
        ä¸€å¥è©±ï¼š${r.focus||""}<br>
        å®Œæˆï¼š${r.done||""}<br>
        æ˜æ—¥ï¼š${r.tomorrow||""}
      </div>`;
  });
});

/* åŒ¯å‡º */
async function exportTXT(){
  let out="";
  const s=await db.collection("days").orderBy("date").get();
  s.forEach(d=>{
    const r=d.data();
    out+=`ã€${r.date}ã€‘
ä¸€å¥è©±ï¼š${r.focus||""}
å®Œæˆï¼š${r.done||""}
æ˜æ—¥ï¼š${r.tomorrow||""}

`;
  });
  txtOutput.textContent=out;
  const blob=new Blob([out],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="é€€ä¼‘ç”Ÿæ´»æ—¥èªŒ.txt";
  a.click();
}
</script>

</body>
</html>
